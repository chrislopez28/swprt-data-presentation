---
title: "R for Water Quality: <br>Region 4 Experiences"
author: "Chris Lopez <br>Los Angeles Water Board"
date: "December 11, 2018"
output: ioslides_presentation
autosize: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

<style>
div.footnotes {
  position: absolute;
  bottom: 0;
  margin-bottom: 10px;
  width: 80%;
  font-size: 0.6em;
}
</style>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>

<script>
  $(document).ready(function() {
    $('slide:not(.backdrop):not(.title-slide)').append('<div class=\"footnotes\">');

    $('footnote').each(function(index) {
      var text  = $(this).html();
      var fnNum = (index+1).toString().sup();
      $(this).html(text + fnNum);

      var footnote   = fnNum + ': ' + $(this).attr('content') + '<br/>';
      var oldContent = $(this).parents('slide').children('div.footnotes').html();
      var newContent = oldContent + footnote;
      $(this).parents('slide').children('div.footnotes').html(newContent);
    });
  });
</script>

<style>
.small-code pre code {
  font-size: 1em;
}
</style>

## R Markdown

This is an R Markdown presentation. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document.

## Presentation Objectives

- Examples of R
- Weaknesses and Strengths

## My Background

- WRCE in Municipal Stormwater Permitting Unit (i.e. MS4 Unit)
- Some rudimentary background in programming/coding
- Enjoy learning new things

## Some Background of R

- __Programming__ Language and Environment for Statistical Computing and Graphics
- __Open-source__
- Large ecosystem of freely available __packages__

## RStudio

- Free and Open-Source "Integrated Development Environment (IDE)" for R
- _Highly, highly recommended if you want to use <footnote content="Chris is not affiliated with RStudio nor receives any incentives for recommending RStudio">R!!!_

<img src="images/RStudio.png" align="middle" height="200" width="400") />


## What does R look like?

<img src="images/rstudioscreen.png" align="middle" height="450" width="750" margin="0 auto" />

## What does R look like?

<img src="images/rstudioscreen_captions.png" align="middle" height="450" width="750" margin="0 auto" />

## Example 1: Plotting IGP Sites on Map

1. Use **SMARTS** Storm Water Data File Download menu, download a tab-delimited file text file of "Storm Water Applications - General Information" for Region 4. 
2. Load the file into R and filter for **active IGP** sites.
3. Use Leaflet package to plot sites on map and display specific information on mouseover.

## Example 1: Plotting IGP Sites on Map

```{r igp_code, echo =TRUE, message=FALSE, eval=FALSE}

library(dplyr)
library(leaflet)
library(htmltools)

# Load File
filename <- "data/smarts_swapps_geninfo_2018-12-09.txt"
rb4 <- read.delim(filename, sep = "\t", stringsAsFactors = FALSE)

# Filter IGP Sites
rb4igp <- rb4 %>% 
  filter(PERMIT_TYPE == "Industrial") %>%
  filter(STATUS == "Active")

# Plot Map Using Leaflet (code for labels omitted due to space)
leaflet(rb4igp) %>% addTiles() %>%
  addCircles(lng = ~FACILITY_SITE_LONGITUDE, lat = ~FACILITY_SITE_LATITUDE,
             opacity = 0.75, label = lapply(labs, HTML))
  
```

## Example 1: Plotting IGP Sites on Map

```{r industrial, echo = FALSE, message=FALSE}
library(dplyr)
library(leaflet)
library(htmltools)

filename <- "data/smarts_swapps_geninfo_2018-12-09.txt"

rb4 <- read.delim(filename, sep = "\t", stringsAsFactors = FALSE)

rb4igp <- rb4 %>%
  filter(PERMIT_TYPE == "Industrial") %>%
  filter(STATUS == "Active")

labs <- lapply(seq(nrow(rb4igp)), function(i) {
  paste0( '<b>', rb4igp[i, "OWNER_OPERATOR_NAME"], '</b></br>', 
          rb4igp[i, "FACILITY_SITE_NAME"], '</br>', 
          rb4igp[i, "FACILITY_SITE_ADDRESS"], '</br>', 
          rb4igp[i, "FACILITY_SITE_CITY"], ', ', 
          rb4igp[i, "FACILITY_SITE_STATE"], ' ', 
          rb4igp[i, "FACILITY_SITE_ZIP"]) 
})

leaflet(rb4igp) %>% 
  addTiles() %>%
  addCircles(lng = ~FACILITY_SITE_LONGITUDE, lat = ~FACILITY_SITE_LATITUDE,
             opacity = 0.75, label = lapply(labs, HTML))
  
```

## Slide with Plot

```{r pressure}
plot(pressure)
```

